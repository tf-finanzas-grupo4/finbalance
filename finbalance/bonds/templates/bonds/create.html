{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Agregar Bono - FinBalance</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    {% tailwind_css %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Función para manejar la lógica de la tasa de interés
            function handleTasaInteres() {
                const tipoTasa = document.querySelector('select[name="tipo_tasa_interes"]');
                const capitalizacionDiv = document.querySelector('div[name="capitalizacion_container"]');
                
                if (tipoTasa.value === 'nominal') {
                    capitalizacionDiv.classList.remove('opacity-50');
                    capitalizacionDiv.querySelector('select').disabled = false;
                } else {
                    capitalizacionDiv.classList.add('opacity-50');
                    capitalizacionDiv.querySelector('select').disabled = true;
                    capitalizacionDiv.querySelector('select').value = '';
                }
            }
            
            // Función para manejar la lógica del plazo de gracia
            function handlePlazoGracia() {
                const tieneGracia = document.querySelector('select[name="tiene_plazo_gracia"]');
                const graciaFields = document.querySelector('div[name="plazo_gracia_fields"]');
                
                if (tieneGracia.value === 'si') {
                    graciaFields.classList.remove('hidden');
                } else {
                    graciaFields.classList.add('hidden');
                    graciaFields.querySelector('input[name="periodos_gracia"]').value = '';
                    graciaFields.querySelector('select[name="tipo_gracia"]').value = '';
                }
            }
            
            // Asignar eventos
            document.querySelector('select[name="tipo_tasa_interes"]').addEventListener('change', handleTasaInteres);
            document.querySelector('select[name="tiene_plazo_gracia"]').addEventListener('change', handlePlazoGracia);
            
            // Ejecutar al cargar la página
            handleTasaInteres();
            handlePlazoGracia();
        });
    </script>
</head>

<body class="bg-gray-50 font-sans leading-normal tracking-normal">
    <!-- Sidebar -->
    {% include 'components/sidebar.html' %}
    <main class="ml-64">
        <div class="space-y-6 p-8">
            <!-- Header -->
            <div>
                <h2 class="text-3xl font-bold text-gray-800">Agregar Bono</h2>
            </div>
            
            <!-- Form -->
            <div class="rounded-lg p-8">
                <form method="POST" action="{% url 'bonds:create' %}" class="space-y-6">
                    {% csrf_token %}
                    
                    <!-- Primera fila -->
                    <div class="flex gap-6">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor Nominal</label>
                            <input type="number" name="valor_nominal" step="0.01" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese el valor nominal">
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Valor Comercial</label>
                            <input type="number" name="valor_comercial" step="0.01" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese el valor comercial">
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nº de Años</label>
                            <input type="number" name="num_anios" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese número de años">
                        </div>
                    </div>
                    
                    <!-- Segunda fila -->
                    <div class="flex gap-6">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Frecuencia del cupón</label>
                            <select name="frecuencia_cupon" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Seleccione frecuencia</option>
                                <option value="12">Mensual (12 pagos/año)</option>
                                <option value="6">Bimestral (6 pagos/año)</option>
                                <option value="4">Trimestral (4 pagos/año)</option>
                                <option value="3">Cuatrimestral (3 pagos/año)</option>
                                <option value="2">Semestral (2 pagos/año)</option>
                                <option value="1">Anual (1 pago/año)</option>
                            </select>
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Días por Año</label>
                            <select name="dias_por_anio" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="360">360 días</option>
                                <option value="365">365 días</option>
                            </select>
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Tasa de Interés</label>
                            <select name="tipo_tasa_interes" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Seleccione tipo</option>
                                <option value="nominal">Nominal</option>
                                <option value="efectiva">Efectiva</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Tercera fila -->
                    <div class="flex gap-6">
                        <div class="flex-1" name="capitalizacion_container">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Frecuencia de Capitalización</label>
                            <select name="capitalizacion" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Seleccione frecuencia</option>
                                <option value="365">Diaria (365 veces/año)</option>
                                <option value="24">Quincenal (24 veces/año)</option>
                                <option value="12">Mensual (12 veces/año)</option>
                                <option value="6">Bimestral (6 veces/año)</option>
                                <option value="4">Trimestral (4 veces/año)</option>
                                <option value="3">Cuatrimestral (3 veces/año)</option>
                                <option value="2">Semestral (2 veces/año)</option>
                                <option value="1">Anual (1 vez/año)</option>
                            </select>
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tasa de interés</label>
                            <input type="number" name="tasa_interes" step="0.01" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese tasa de interés">
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tasa anual de descuento</label>
                            <input type="number" name="tasa_anual_descuento" step="0.01" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese tasa de descuento">
                        </div>
                    </div>

                    <!-- Cuarta fila -->
                    <div class="flex gap-6">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Impuesto a la Renta</label>
                            <input type="number" name="impuesto_renta" step="0.01" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese impuesto">
                        </div>

                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Fecha de Emisión</label>
                            <input type="date" name="fecha_emision" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">% Prima</label>
                            <input type="number" name="porcentaje_prima" step="0.01"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese % prima">
                        </div>
                    </div>

                    <!-- Quinta fila - Plazo de gracia -->
                    <div class="flex gap-6">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">¿Tiene plazo de gracia?</label>
                            <select name="tiene_plazo_gracia" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="no">No</option>
                                <option value="si">Sí</option>
                            </select>
                        </div>
                        
                        <div class="flex-1 hidden" name="plazo_gracia_fields">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nº Periodos de Gracia</label>
                            <input type="number" name="periodos_gracia"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="Ingrese periodos">
                        </div>
                        
                        <div class="flex-1 hidden" name="plazo_gracia_fields">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo de Gracia</label>
                            <select name="tipo_gracia"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="parcial">Parcial</option>
                                <option value="total">Total</option>
                                <option value="normal">Normal</option>
                            </select>
                        </div>
                    </div>

                    <!-- Sexta fila - Estructuración -->
                    <div class="flex gap-6">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">% Estructuración</label>
                            <div class="flex gap-2">
                                <input type="number" name="porcentaje_estructuracion" step="0.01"
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                       placeholder="% valor">
                                <select name="tipo_estructuracion"
                                        class="w-32 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="emisor">Emisor</option>
                                    <option value="bonista">Bonista</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                        </div>

                        <!-- Colocación -->
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">% Colocación</label>
                            <div class="flex gap-2">
                                <input type="number" name="porcentaje_colocacion" step="0.01"
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                       placeholder="% valor">
                                <select name="tipo_colocacion"
                                        class="w-32 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="emisor">Emisor</option>
                                    <option value="bonista">Bonista</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Flotación -->
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">% Flotación</label>
                            <div class="flex gap-2">
                                <input type="number" name="porcentaje_flotacion" step="0.01"
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                       placeholder="% valor">
                                <select name="tipo_flotacion"
                                        class="w-32 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="emisor">Emisor</option>
                                    <option value="bonista">Bonista</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Séptima fila - CAVALI -->
                    <div class="flex gap-6">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">% CAVALI</label>
                            <div class="flex gap-2">
                                <input type="number" name="porcentaje_cavali" step="0.01"
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                       placeholder="% valor">
                                <select name="tipo_cavali"
                                        class="w-32 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                    <option value="emisor">Emisor</option>
                                    <option value="bonista">Bonista</option>
                                    <option value="ambos">Ambos</option>
                                </select>
                            </div>
                        </div>
                    </div>
                             
                    <!-- Botón -->
                    <div class="pt-6 text-right">
                        <button type="submit" class="w-80 py-3 text-white rounded-lg font-medium hover:opacity-90 transition-opacity" style="background-color: #1E3C99;">
                            Aceptar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</body>
</html>